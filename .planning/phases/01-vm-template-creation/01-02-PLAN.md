---
phase: 01-vm-template-creation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - hosts/endurance/README.md
autonomous: false

must_haves:
  truths:
    - "Omarchy desktop environment installed and functional"
    - "SSH server running and accessible from macOS host"
    - "NetworkManager managing network connections"
    - "Rosetta binary accessible at /mnt/psf/RosettaLinux/rosetta"
    - "Dotfiles accessible at /mnt/psf/Home/Documents/dotfiles"
  artifacts:
    - path: "hosts/endurance/README.md"
      provides: "Omarchy installation and service configuration documentation"
      contains: "Omarchy Installation"
  key_links:
    - from: "Parallels shared folders"
      to: "/mnt/psf/Home"
      via: "prltoolsd mount"
    - from: "SSH server"
      to: "macOS host"
      via: "bridged network"
---

<objective>
Document and execute Omarchy desktop installation and service configuration on the base VM.

Purpose: Install the Omarchy (Hyprland) desktop environment and configure SSH/NetworkManager so the template has a functional desktop and remote access.

Output: VM with Omarchy desktop and SSH access working, plus updated documentation.
</objective>

<execution_context>
@/Users/andreym/.claude/get-shit-done/workflows/execute-plan.md
@/Users/andreym/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-vm-template-creation/01-CONTEXT.md
@.planning/phases/01-vm-template-creation/01-RESEARCH.md
@.planning/phases/01-vm-template-creation/01-01-SUMMARY.md
@hosts/endurance/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document Omarchy installation and service setup</name>
  <files>hosts/endurance/README.md</files>
  <action>
Add to hosts/endurance/README.md after the base installation section:

## Omarchy Desktop Installation

### Step 8: Install Omarchy (ARM64)

Document the Omarchy installation using PR #1897 for ARM64 support:

```bash
# Install armarchy (Omarchy ARM64 fork)
curl -fsSL hdwy.link/armarchy-3-x | bash
```

Or the explicit method:
```bash
wget -qO- https://raw.githubusercontent.com/jondkinney/armarchy/amarchy-3-x/boot.sh | \
  OMARCHY_REPO=jondkinney/armarchy OMARCHY_REF=amarchy-3-x bash
```

Document:
- What the installer does (installs Hyprland, configures desktop)
- Any interactive prompts and recommended responses
- Expected completion state

### Step 9: Configure SSH Access

Document SSH configuration for template:
```bash
# Enable SSH server
sudo systemctl enable --now sshd

# Add macOS host public key (copy from host)
mkdir -p ~/.ssh
chmod 700 ~/.ssh
# User will paste their public key
echo "ssh-ed25519 AAAA... user@host" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

Document:
- How to get VM's IP address (`ip addr` or check Parallels network settings)
- SSH connection test from macOS: `ssh user@<vm-ip>`

### Step 10: Verify Parallels Integration

Document verification commands:
```bash
# Check Rosetta binary is accessible
ls -la /mnt/psf/RosettaLinux/rosetta

# Check shared folders mounted
ls /mnt/psf/Home/Documents/dotfiles

# Check networking
ip addr show
ping -c 3 8.8.8.8
```

Note any timing issues (Parallels mounts may take a moment after boot).
  </action>
  <verify>
Read hosts/endurance/README.md and confirm:
- Omarchy installation commands present (both short and explicit URLs)
- SSH setup documented with key installation
- Parallels integration verification steps included
  </verify>
  <done>Documentation for Steps 8-10 (Omarchy, SSH, Parallels verification) added to README</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Execute Omarchy installation and service setup</name>
  <action-required>
Follow Steps 8-10 in hosts/endurance/README.md:

1. Boot into the VM (enter LUKS passphrase)
2. Login as user
3. Run the armarchy installer
4. Follow any interactive prompts
5. Enable and configure SSH
6. Add your SSH public key
7. Test SSH connection from macOS
8. Verify Parallels shared folders and Rosetta binary
  </action-required>
  <how-to-verify>
After completing the steps:

From the VM:
1. Hyprland desktop should launch (or be launchable)
2. `systemctl status sshd` should show active
3. `ls /mnt/psf/RosettaLinux/rosetta` should show the binary
4. `ls /mnt/psf/Home/Documents/dotfiles` should show your dotfiles

From macOS:
1. `ssh user@<vm-ip>` should connect without password prompt
2. After SSH, run `ls /mnt/psf/Home` to verify shared folders work
  </how-to-verify>
  <resume-signal>Type "omarchy complete" when desktop and SSH work, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After human completes Omarchy installation:
- [ ] Omarchy/Hyprland desktop launches
- [ ] SSH access works from macOS host with key auth
- [ ] Rosetta binary accessible at expected path
- [ ] Shared folders mount dotfiles correctly
- [ ] NetworkManager manages network (not manual config)
</verification>

<success_criteria>
1. Omarchy desktop environment installed and functional
2. SSH server running with key-based authentication
3. Parallels integration (shared folders, Rosetta) verified
4. Documentation updated with actual commands used
</success_criteria>

<output>
After completion, create `.planning/phases/01-vm-template-creation/01-02-SUMMARY.md`
</output>
